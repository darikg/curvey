
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../curves/">
      
      
        <link rel="next" href="../blend/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.14">
    
    
      
        <title>Flow - Curvey</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.10ba22f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#curveyflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Curvey" class="md-header__button md-logo" aria-label="Curvey" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Curvey
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flow
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/darikg/curvey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorial/introduction/" class="md-tabs__link">
          
  
    
  
  Tutorial

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../curve/" class="md-tabs__link">
          
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../bibliography/" class="md-tabs__link">
        
  
    
  
  Bibliography

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Curvey" class="md-nav__button md-logo" aria-label="Curvey" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Curvey
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/darikg/curvey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/shape_structure_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shape structure dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/flow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/blend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../curve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Curve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../curves/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Curves
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Flow
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Flow
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#curvey.flow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractCurvatureFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AbstractCurvatureFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AbstractCurvatureFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractCurvatureFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractCurvatureFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AbstractFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AbstractFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow.step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CurveShorteningFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" CurveShorteningFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.RetryStep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RetryStep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SingularityFreeMeanCurvatureFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SingularityFreeMeanCurvatureFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Solver
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Solver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.add_curve_loggers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_curve_loggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.add_stop_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_stop_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.attach_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;attach_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.log" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.stop_on_param_limits" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stop_on_param_limits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.StopEarly" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;StopEarly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;WillmoreFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" WillmoreFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.autotimestep_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;autotimestep_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.constrain_flow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;constrain_flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.energy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.filter_flow_direction" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter_flow_direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.stop_on_gradient_tolerance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stop_on_gradient_tolerance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.with_tgt_curvature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;with_tgt_curvature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shape_structure_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shape structure dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Util
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bibliography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bibliography
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#curvey.flow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractCurvatureFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AbstractCurvatureFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AbstractCurvatureFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractCurvatureFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractCurvatureFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AbstractFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AbstractFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.AbstractFlow.step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CurveShorteningFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" CurveShorteningFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.CurveShorteningFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.RetryStep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RetryStep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SingularityFreeMeanCurvatureFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SingularityFreeMeanCurvatureFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.poststep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;poststep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Solver
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Solver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.add_curve_loggers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_curve_loggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.add_stop_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_stop_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.attach_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;attach_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.log" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.Solver.stop_on_param_limits" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stop_on_param_limits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.StopEarly" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;StopEarly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;WillmoreFlow
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" WillmoreFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.autotimestep_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;autotimestep_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.constrain_flow" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;constrain_flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.default_curvature_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;default_curvature_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.energy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.filter_flow_direction" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter_flow_direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.solver" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.stop_on_gradient_tolerance" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stop_on_gradient_tolerance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curvey.flow.WillmoreFlow.with_tgt_curvature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;with_tgt_curvature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="curveyflow">curvey.flow<a class="headerlink" href="#curveyflow" title="Permanent link">¤</a></h1>


<div class="doc doc-object doc-module">



<h2 id="curvey.flow" class="doc doc-heading">
          <code>flow</code>


<a href="#curvey.flow" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents first">
  
      <p>Definitions of flow infrastructure and implementations of some common flows</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="curvey.flow.AbstractCurvatureFlow" class="doc doc-heading">
          <code>AbstractCurvatureFlow</code>


<a href="#curvey.flow.AbstractCurvatureFlow" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="curvey.flow.AbstractFlow" href="#curvey.flow.AbstractFlow">AbstractFlow</a>[<span title="curvey.flow.TData">TData</span>]</code>, <code><span title="typing.Generic">Generic</span>[<span title="curvey.flow.TData">TData</span>]</code></p>

  
      <p>Abstract superclass for curvature flows</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>curvature_fn</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a>], <span title="numpy.ndarray">ndarray</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function <code>Curve -&gt; ndarray</code> that returns the signed curvature values at each vertex.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>rescale</code></td>
          <td>
                <code><span title="typing.Literal">Literal</span>[&#39;length&#39;, &#39;area&#39;] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If this is 'length' or 'area', the recurve length/area is rescaled to the original's
length or area, preventing the usual curvature flow shrinkage.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="k">class</span> <span class="nc">AbstractCurvatureFlow</span><span class="p">(</span><span class="n">AbstractFlow</span><span class="p">[</span><span class="n">TData</span><span class="p">],</span> <span class="n">Generic</span><span class="p">[</span><span class="n">TData</span><span class="p">]):</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract superclass for curvature flows</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">    curvature_fn</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        A function `Curve -&gt; ndarray` that returns the signed curvature values at each vertex.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    rescale</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        If this is &#39;length&#39; or &#39;area&#39;, the recurve length/area is rescaled to the original&#39;s</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        length or area, preventing the usual curvature flow shrinkage.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="n">curvature_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">rescale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="p">):</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span> <span class="o">=</span> <span class="n">curvature_fn</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_curvature_fn</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rescale</span> <span class="o">=</span> <span class="n">rescale</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">]:</span> <span class="o">...</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">def</span> <span class="nf">_postprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale</span> <span class="o">==</span> <span class="s2">&quot;area&quot;</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">initial</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">curve</span><span class="o">.</span><span class="n">area</span><span class="p">))</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale</span> <span class="o">==</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">initial</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="n">curve</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="k">return</span> <span class="n">curve</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="k">def</span> <span class="nf">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Simply return the value of the `Curve.curvature` property&quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">curvature</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="curvey.flow.AbstractCurvatureFlow.default_curvature_fn" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.AbstractCurvatureFlow.default_curvature_fn" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Simply return the value of the <code>Curve.curvature</code> property</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="k">def</span> <span class="nf">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Simply return the value of the `Curve.curvature` property&quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">curvature</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.AbstractCurvatureFlow.poststep" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poststep</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.AbstractCurvatureFlow.poststep" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Called after stepping the curve, but before logging it</p>
<p>This is called after attaching additional curve metadata requested by curve loggers.</p>
<p>Subclasses can raise <code>RetryStep</code> or <code>StopEarly</code> here if necessary, or further process the
curve.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span> <span class="nf">poststep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>  <span class="c1"># noqa: ARG002</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Called after stepping the curve, but before logging it</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    This is called after attaching additional curve metadata requested by curve loggers.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Subclasses can raise `RetryStep` or `StopEarly` here if necessary, or further process the</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    curve.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.AbstractFlow" class="doc doc-heading">
          <code>AbstractFlow</code>


<a href="#curvey.flow.AbstractFlow" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="typing.Generic">Generic</span>[<span title="curvey.flow.TData">TData</span>]</code></p>

  
      <p>Abstract superclass for curve flow</p>
<p>The basic contract is that <code>Flow</code> objects don't maintain any state specific
to the solution of a flow. All state is stored in the curve metadata
or in the <code>Solver.data</code> class, which is generic over the <code>TData</code> type.</p>
<p>Two methods for subclasses to implement: <code>step</code>, which steps the curve by the
supplied timestep, and <code>solver</code>, which constructs the auxillary <code>Solver</code> object with
flow-specific <code>data: TData</code>.</p>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="k">class</span> <span class="nc">AbstractFlow</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">TData</span><span class="p">]):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract superclass for curve flow</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    The basic contract is that `Flow` objects don&#39;t maintain any state specific</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    to the solution of a flow. All state is stored in the curve metadata</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    or in the `Solver.data` class, which is generic over the `TData` type.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Two methods for subclasses to implement: `step`, which steps the curve by the</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    supplied timestep, and `solver`, which constructs the auxillary `Solver` object with</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    flow-specific `data: TData`.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">]:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a `Solver` to solve curve flow over time</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        **kwargs are all passed to the `Solver` constructor.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="o">...</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step the curve by `timestep`&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="o">...</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">def</span> <span class="nf">poststep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>  <span class="c1"># noqa: ARG002</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Called after stepping the curve, but before logging it</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        This is called after attaching additional curve metadata requested by curve loggers.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Subclasses can raise `RetryStep` or `StopEarly` here if necessary, or further process the</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        curve.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="curvey.flow.AbstractFlow.poststep" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poststep</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.AbstractFlow.poststep" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Called after stepping the curve, but before logging it</p>
<p>This is called after attaching additional curve metadata requested by curve loggers.</p>
<p>Subclasses can raise <code>RetryStep</code> or <code>StopEarly</code> here if necessary, or further process the
curve.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span> <span class="nf">poststep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>  <span class="c1"># noqa: ARG002</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Called after stepping the curve, but before logging it</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    This is called after attaching additional curve metadata requested by curve loggers.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Subclasses can raise `RetryStep` or `StopEarly` here if necessary, or further process the</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    curve.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.AbstractFlow.solver" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">solver</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#curvey.flow.AbstractFlow.solver" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Construct a <code>Solver</code> to solve curve flow over time</p>
<p>**kwargs are all passed to the <code>Solver</code> constructor.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="nd">@abstractmethod</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">]:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a `Solver` to solve curve flow over time</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    **kwargs are all passed to the `Solver` constructor.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.AbstractFlow.step" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">step</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#curvey.flow.AbstractFlow.step" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Step the curve by <code>timestep</code></p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="nd">@abstractmethod</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Step the curve by `timestep`&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.CurveShorteningFlow" class="doc doc-heading">
          <code>CurveShorteningFlow</code>


<a href="#curvey.flow.CurveShorteningFlow" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="curvey.flow.AbstractCurvatureFlow" href="#curvey.flow.AbstractCurvatureFlow">AbstractCurvatureFlow</a>[<span title="curvey.flow._CsfData">_CsfData</span>]</code></p>

  
      <p>Basic curve shortening flow</p>
<p>At each iteration, vertices coordinates are moved by <span class="arithmatex">\(\Delta t \kappa_i N_i\)</span>, for
timestep <span class="arithmatex">\(\Delta t\)</span> and vertex curvatures <span class="arithmatex">\(\kappa_i\)</span> and normal <span class="arithmatex">\(N_i\)</span>.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>resample_mode</code></td>
          <td>
                <code><span title="curvey.util.InterpType">InterpType</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Type of interpolation to use when resampling, one of ('linear', 'cubic', 'pchip').</p>
            </div>
          </td>
          <td>
                <code>&#39;cubic&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Remaining kwargs are passed to the <code>AbstractCurvatureFlow</code> constructor.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="k">class</span> <span class="nc">CurveShorteningFlow</span><span class="p">(</span><span class="n">AbstractCurvatureFlow</span><span class="p">[</span><span class="n">_CsfData</span><span class="p">]):</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Basic curve shortening flow</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    At each iteration, vertices coordinates are moved by $\Delta t \kappa_i N_i$, for</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    timestep $\Delta t$ and vertex curvatures $\kappa_i$ and normal $N_i$.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    resample_mode</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        Type of interpolation to use when resampling, one of (&#39;linear&#39;, &#39;cubic&#39;, &#39;pchip&#39;).</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    **kwargs</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        Remaining kwargs are passed to the `AbstractCurvatureFlow` constructor.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">resample_mode</span><span class="p">:</span> <span class="n">InterpType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;cubic&quot;</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="p">):</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resample_mode</span> <span class="o">=</span> <span class="n">resample_mode</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_CsfData</span><span class="p">]:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a `CurveShorteningFlow` `Solver`</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        **kwargs are all passed to the `Solver` constructor.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">_CsfData</span><span class="p">(</span><span class="n">orig_thresh</span><span class="o">=</span><span class="n">initial</span><span class="o">.</span><span class="n">edge_length</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="k">return</span> <span class="n">Solver</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_CsfData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">timestep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)[:,</span> <span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">curve</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_postprocess</span><span class="p">(</span><span class="n">curve</span><span class="o">=</span><span class="n">curve</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample_mode</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">interpolate_thresh</span><span class="p">(</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="n">thresh</span><span class="o">=</span><span class="n">solver</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig_thresh&quot;</span><span class="p">],</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                <span class="n">typ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resample_mode</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="p">)</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="curvey.flow.CurveShorteningFlow.default_curvature_fn" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.CurveShorteningFlow.default_curvature_fn" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Simply return the value of the <code>Curve.curvature</code> property</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="k">def</span> <span class="nf">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Simply return the value of the `Curve.curvature` property&quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">curvature</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.CurveShorteningFlow.poststep" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poststep</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.CurveShorteningFlow.poststep" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Called after stepping the curve, but before logging it</p>
<p>This is called after attaching additional curve metadata requested by curve loggers.</p>
<p>Subclasses can raise <code>RetryStep</code> or <code>StopEarly</code> here if necessary, or further process the
curve.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span> <span class="nf">poststep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>  <span class="c1"># noqa: ARG002</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Called after stepping the curve, but before logging it</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    This is called after attaching additional curve metadata requested by curve loggers.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Subclasses can raise `RetryStep` or `StopEarly` here if necessary, or further process the</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    curve.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.CurveShorteningFlow.solver" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">solver</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_CsfData</span><span class="p">]</span></code>

<a href="#curvey.flow.CurveShorteningFlow.solver" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Construct a <code>CurveShorteningFlow</code> <code>Solver</code></p>
<p>**kwargs are all passed to the <code>Solver</code> constructor.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_CsfData</span><span class="p">]:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a `CurveShorteningFlow` `Solver`</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    **kwargs are all passed to the `Solver` constructor.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">_CsfData</span><span class="p">(</span><span class="n">orig_thresh</span><span class="o">=</span><span class="n">initial</span><span class="o">.</span><span class="n">edge_length</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="k">return</span> <span class="n">Solver</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.RetryStep" class="doc doc-heading">
          <code>RetryStep</code>


<a href="#curvey.flow.RetryStep" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>Exception</code></p>

  
      <p>This can be raised in a custom <code>Solver.step_fn</code> to retry the current step</p>
<p>Usually after adjusting the timestep or some other state.</p>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">class</span> <span class="nc">RetryStep</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This can be raised in a custom `Solver.step_fn` to retry the current step</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    Usually after adjusting the timestep or some other state.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.SingularityFreeMeanCurvatureFlow" class="doc doc-heading">
          <code>SingularityFreeMeanCurvatureFlow</code>


<a href="#curvey.flow.SingularityFreeMeanCurvatureFlow" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="curvey.flow.AbstractCurvatureFlow" href="#curvey.flow.AbstractCurvatureFlow">AbstractCurvatureFlow</a></code></p>

  
      <p>Singularity free mean curvature flow</p>
<p>As defined in</p>
<p><a href="https://arxiv.org/abs/1203.6819"><em>Can Mean-Curvature Flow Be Made Non-Singular?</em> Michael Kazhdan, Jake Solomon, and Mirela Ben-Chen.
2012.</a></p>
<p>That paper suggests this shouldn't really be necessary in the planar curve case, as curves in
the continuous case can't form singularities anyway, but it does seem to be much more
numerically stable than the traditional approach, and doesn't require resampling the curve.</p>
<p>See also the explanation in</p>
<p><a href="https://sibgrapi.sid.inpe.br/col/sid.inpe.br/sibgrapi/2017/09.04.18.39/doc/Mean%20Curvature%20Flow%20and%20Applications.pdf"><em>Mean Curvature Flow and Applications</em>. Maria Eduarda Duarte and Leonardo Sacht. 2017.</a></p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>All kwargs passed to <code>AbstractCurvatureFlow</code> constructor.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="k">class</span> <span class="nc">SingularityFreeMeanCurvatureFlow</span><span class="p">(</span><span class="n">AbstractCurvatureFlow</span><span class="p">):</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Singularity free mean curvature flow</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">    As defined in</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">    [*Can Mean-Curvature Flow Be Made Non-Singular?* Michael Kazhdan, Jake Solomon, and Mirela Ben-Chen.</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">    2012.](https://arxiv.org/abs/1203.6819)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">    That paper suggests this shouldn&#39;t really be necessary in the planar curve case, as curves in</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">    the continuous case can&#39;t form singularities anyway, but it does seem to be much more</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">    numerically stable than the traditional approach, and doesn&#39;t require resampling the curve.</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">    See also the explanation in</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">    [*Mean Curvature Flow and Applications*. Maria Eduarda Duarte and Leonardo Sacht. 2017.](</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">    https://sibgrapi.sid.inpe.br/col/sid.inpe.br/sibgrapi/2017/09.04.18.39/doc/Mean%20Curvature%20Flow%20and%20Applications.pdf)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="sd">    **kwargs</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">        All kwargs passed to `AbstractCurvatureFlow` constructor.</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_SfmcfData</span><span class="p">]:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a solver for this flow</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        All **kwargs are passed to the `Solver` constructor.</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="n">stiffness</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">initial</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span> <span class="o">@</span> <span class="n">initial</span><span class="o">.</span><span class="n">laplacian</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">_SfmcfData</span><span class="p">(</span><span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">)</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="k">return</span> <span class="n">Solver</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_SfmcfData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="n">inv_mass</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span>  <span class="c1"># The $D_t^-1$ matrix</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="n">stiffness</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stiffness&quot;</span><span class="p">]</span>  <span class="c1"># The stiffness $L_0$</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="c1"># noinspection PyTypeChecker</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="n">pts</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">spsolve</span><span class="p">(</span><span class="n">inv_mass</span> <span class="o">-</span> <span class="n">timestep</span> <span class="o">*</span> <span class="n">stiffness</span><span class="p">,</span> <span class="n">inv_mass</span> <span class="o">@</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_postprocess</span><span class="p">(</span><span class="n">curve</span><span class="o">=</span><span class="n">curve</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="curvey.flow.SingularityFreeMeanCurvatureFlow.default_curvature_fn" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.default_curvature_fn" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Simply return the value of the <code>Curve.curvature</code> property</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="k">def</span> <span class="nf">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Simply return the value of the `Curve.curvature` property&quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">curvature</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.SingularityFreeMeanCurvatureFlow.poststep" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">poststep</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.poststep" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Called after stepping the curve, but before logging it</p>
<p>This is called after attaching additional curve metadata requested by curve loggers.</p>
<p>Subclasses can raise <code>RetryStep</code> or <code>StopEarly</code> here if necessary, or further process the
curve.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span> <span class="nf">poststep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">TData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>  <span class="c1"># noqa: ARG002</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Called after stepping the curve, but before logging it</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    This is called after attaching additional curve metadata requested by curve loggers.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Subclasses can raise `RetryStep` or `StopEarly` here if necessary, or further process the</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    curve.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.SingularityFreeMeanCurvatureFlow.solver" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">solver</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_SfmcfData</span><span class="p">]</span></code>

<a href="#curvey.flow.SingularityFreeMeanCurvatureFlow.solver" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Construct a solver for this flow</p>
<p>All **kwargs are passed to the <code>Solver</code> constructor.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_SfmcfData</span><span class="p">]:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a solver for this flow</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    All **kwargs are passed to the `Solver` constructor.</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="n">stiffness</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">initial</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span> <span class="o">@</span> <span class="n">initial</span><span class="o">.</span><span class="n">laplacian</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">_SfmcfData</span><span class="p">(</span><span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness</span><span class="p">)</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>    <span class="k">return</span> <span class="n">Solver</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.Solver" class="doc doc-heading">
          <code>Solver</code>


<a href="#curvey.flow.Solver" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="typing.Generic">Generic</span>[<span title="curvey.flow.TData">TData</span>]</code></p>

  
      <p>Auxillary class for solving curve <code>Flow</code>s</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>flow</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="curvey.flow.AbstractFlow" href="#curvey.flow.AbstractFlow">AbstractFlow</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The <code>Flow</code> object we're solving</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>initial</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The initial <code>Curve</code> to start solving from</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestep</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>For fixed timesteps</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>timestep_fn</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="curvey.flow.Solver" href="#curvey.flow.Solver">Solver</a>], float] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function <code>Solver -&gt; float</code> that can adaptively decide a timestep on each iteration.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>history</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If true, the <code>Curve</code> after each iteration is stored in <code>Solver.history</code>, a <code>Curves</code> object.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>max_step</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum number of iterations to run.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>stop_on_non_simple</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A step whose <code>Curve.is_simple == False</code> stops the run, discarding the non-simple
curve.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If true, curve state information and stopping messages are printed to stdout on each
iteration.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>log</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If true, the printed log messages as in <code>verbose</code> are saved as a list of <code>str</code>s in
<code>Solver.log</code></p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="curvey.flow.TData">TData</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flow specific data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>step_fn</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="curvey.flow.Solver" href="#curvey.flow.Solver">Solver</a>], <a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function <code>Solver -&gt; Curve</code> that steps the curve forward at each iteration. This just
defaults to <code>Solver.step</code>.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">TData</span><span class="p">]):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Auxillary class for solving curve `Flow`s</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    flow</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        The `Flow` object we&#39;re solving</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    initial</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        The initial `Curve` to start solving from</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    timestep</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        For fixed timesteps</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    timestep_fn</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        A function `Solver -&gt; float` that can adaptively decide a timestep on each iteration.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    history</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        If true, the `Curve` after each iteration is stored in `Solver.history`, a `Curves` object.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    max_step</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        Maximum number of iterations to run.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    stop_on_non_simple</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        A step whose `Curve.is_simple == False` stops the run, discarding the non-simple</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        curve.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    verbose</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        If true, curve state information and stopping messages are printed to stdout on each</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        iteration.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    log</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        If true, the printed log messages as in `verbose` are saved as a list of `str`s in</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        `Solver.log`</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    data</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Flow specific data.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    step_fn</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        A function `Solver -&gt; Curve` that steps the curve forward at each iteration. This just</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        defaults to `Solver.step`.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">flow</span><span class="p">:</span> <span class="n">AbstractFlow</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">TData</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">timestep_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">max_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">stop_on_non_simple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">step_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="n">Curve</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="p">):</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">initial</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">initial</span><span class="o">.</span><span class="n">with_data</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">previous</span><span class="p">:</span> <span class="n">Curve</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">timestep</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="o">=</span> <span class="n">timestep_fn</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">:</span> <span class="n">Curves</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">if</span> <span class="n">history</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="c1"># Note that we don&#39;t log the first curve until</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="c1"># self.run() in case some extra initialization needs to happen somewhere</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">Curves</span><span class="p">([])</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">log</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_step</span> <span class="o">=</span> <span class="n">max_step</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_on_non_simple</span> <span class="o">=</span> <span class="n">stop_on_non_simple</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_fns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_curve_loggers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_fn</span> <span class="o">=</span> <span class="n">step_fn</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">solver_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">flow_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s2">(flow=</span><span class="si">{</span><span class="n">flow_name</span><span class="si">}</span><span class="s2">, current=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a message</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        This is always sent to the module `logging.logger` at debug level.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        If `self.verbose` is true, it&#39;s also printed to stdout.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        If `self.log` is true, it&#39;s saved as a str in self.log_history</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">_BraceMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bm</span><span class="p">:</span> <span class="n">_BraceMessage</span><span class="p">):</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="k">pass</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bm</span><span class="p">))</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">def</span> <span class="nf">_log_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">_BraceMessage</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">def</span> <span class="nf">_log_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="n">Curve</span><span class="p">):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">_BraceMessage</span><span class="p">(</span><span class="s2">&quot;Step </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">])</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">c0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">ks</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">c1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="s2">&quot;step&quot;</span><span class="p">}</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> =&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">c1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span> <span class="nf">_stop_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if run should stop&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_step</span><span class="p">:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Stopping at max step </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">])</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_fns</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="k">if</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Stopping due to stop fn </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="k">def</span> <span class="nf">add_stop_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a custom stop function. The run is stopped early if `fn(curve)` returns True</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        -------</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        self</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="k">def</span> <span class="nf">add_curve_loggers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log additional information as curve metadata</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        e.g. `solver.add_curve_loggers(foo=foo_fn, bar=bar_fn) will store the results of</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        the function calls `foo_fn(curve)` and `bar_fn(curve)` in the curve metadata &#39;foo&#39; and &#39;bar&#39;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        properties.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        -------</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        self</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_curve_loggers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">def</span> <span class="nf">stop_on_param_limits</span><span class="p">(</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">param_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a custom stop function based on a parameter value</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        param</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">            The name of the parameter. This is usually a curve metadata object, e.g. one logged</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">            via `Solver.add_curve_loggers`. If `param_fn` is supplied, `param` is only used as the</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">            parameter name for logging purposes.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        min_val</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">            The run is stopped if the parameter value &lt; `min_val`. `None` means no lower limit.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        max_val</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">            The run is stopped if the parameter value &gt; `max_val`. `None` means no upper limit.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        param_fn</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">            An optional function `Curve -&gt; value`; if supplied `param` doesn&#39;t need to be available</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">            as `Curve` metadata.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        -------</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        self</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="k">if</span> <span class="n">param_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="k">def</span> <span class="nf">param_fn</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">def</span> <span class="nf">param_limits_stop_fn</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">param_fn</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">{}</span><span class="s2"> value </span><span class="si">{}</span><span class="s2"> &lt; min value </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">min_val</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">if</span> <span class="n">max_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">{}</span><span class="s2"> value </span><span class="si">{}</span><span class="s2"> &gt; max value </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_stop_fn</span><span class="p">(</span><span class="n">param_limits_stop_fn</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve the flow by stepping the curve through time</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        If no stop criterion are specified by `max_step`, `add_stop_fn`, or</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        `stop_on_param_limits`, this might run forever.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        -------</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        self</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attach_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_state</span><span class="p">(</span><span class="s2">&quot;Initial state&quot;</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">step_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_fn</span> <span class="ow">or</span> <span class="n">Solver</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_fn</span><span class="p">():</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="n">next_curve</span> <span class="o">=</span> <span class="n">step_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="n">next_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">poststep</span><span class="p">(</span><span class="n">curve</span><span class="o">=</span><span class="n">next_curve</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="k">except</span> <span class="n">RetryStep</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="k">continue</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="k">except</span> <span class="n">StopEarly</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                <span class="k">break</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_on_non_simple</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">next_curve</span><span class="o">.</span><span class="n">is_simple</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Curve is non-simple, stopping&quot;</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="k">break</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log_step</span><span class="p">(</span><span class="n">next_curve</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">next_curve</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_curve</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_state</span><span class="p">(</span><span class="s2">&quot;Final state&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Call `Flow.step` with the current state and timestep&quot;&quot;&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Neither of `timestep` or `timestep_fn` were provided.&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="c1"># The `Flow` does the actual work here</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">curve</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">solver</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attach_metadata</span><span class="p">(</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">curve</span><span class="o">=</span><span class="n">curve</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">def</span> <span class="nf">attach_metadata</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store requested metadata on the curve</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        curve</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">            The curve after the most recent step.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        time</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">            The time of the curve in the solution.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        step</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            Which step this curve belongs to. This is almost always left None; it defaults</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            to `solver.current[&#39;step&#39;] + 1`.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        **kwargs</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">            Additional metadata to store as key=value pairs.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        -------</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        curve</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            The curve with metadata attached.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve_loggers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">with_data</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.add_curve_loggers" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_curve_loggers</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span></code>

<a href="#curvey.flow.Solver.add_curve_loggers" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Log additional information as curve metadata</p>
<p>e.g. <code>solver.add_curve_loggers(foo=foo_fn, bar=bar_fn) will store the results of
the function calls</code>foo_fn(curve)<code>and</code>bar_fn(curve)` in the curve metadata 'foo' and 'bar'
properties.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>self</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="k">def</span> <span class="nf">add_curve_loggers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Log additional information as curve metadata</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    e.g. `solver.add_curve_loggers(foo=foo_fn, bar=bar_fn) will store the results of</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    the function calls `foo_fn(curve)` and `bar_fn(curve)` in the curve metadata &#39;foo&#39; and &#39;bar&#39;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    properties.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    -------</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    self</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_curve_loggers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.add_stop_fn" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_stop_fn</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span></code>

<a href="#curvey.flow.Solver.add_stop_fn" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Add a custom stop function. The run is stopped early if <code>fn(curve)</code> returns True</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>self</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="k">def</span> <span class="nf">add_stop_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a custom stop function. The run is stopped early if `fn(curve)` returns True</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    -------</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    self</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.attach_metadata" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">attach_metadata</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.Solver.attach_metadata" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Store requested metadata on the curve</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>curve</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The curve after the most recent step.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>time</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The time of the curve in the solution.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>step</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Which step this curve belongs to. This is almost always left None; it defaults
to <code>solver.current['step'] + 1</code>.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional metadata to store as key=value pairs.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="curvey.curve">curve</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The curve with metadata attached.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="k">def</span> <span class="nf">attach_metadata</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Store requested metadata on the curve</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    curve</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        The curve after the most recent step.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    time</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        The time of the curve in the solution.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">    step</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        Which step this curve belongs to. This is almost always left None; it defaults</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        to `solver.current[&#39;step&#39;] + 1`.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    **kwargs</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        Additional metadata to store as key=value pairs.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    -------</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    curve</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        The curve with metadata attached.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve_loggers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">with_data</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.log" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#curvey.flow.Solver.log" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Log a message</p>
<p>This is always sent to the module <code>logging.logger</code> at debug level.
If <code>self.verbose</code> is true, it's also printed to stdout.
If <code>self.log</code> is true, it's saved as a str in self.log_history</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Log a message</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    This is always sent to the module `logging.logger` at debug level.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    If `self.verbose` is true, it&#39;s also printed to stdout.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    If `self.log` is true, it&#39;s saved as a str in self.log_history</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">_BraceMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.run" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#curvey.flow.Solver.run" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Solve the flow by stepping the curve through time</p>
<p>If no stop criterion are specified by <code>max_step</code>, <code>add_stop_fn</code>, or
<code>stop_on_param_limits</code>, this might run forever.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>self</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Solve the flow by stepping the curve through time</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    If no stop criterion are specified by `max_step`, `add_stop_fn`, or</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    `stop_on_param_limits`, this might run forever.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    -------</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    self</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attach_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_log_state</span><span class="p">(</span><span class="s2">&quot;Initial state&quot;</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="n">step_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_fn</span> <span class="ow">or</span> <span class="n">Solver</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_fn</span><span class="p">():</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="n">next_curve</span> <span class="o">=</span> <span class="n">step_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">next_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">poststep</span><span class="p">(</span><span class="n">curve</span><span class="o">=</span><span class="n">next_curve</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">except</span> <span class="n">RetryStep</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="k">continue</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="k">except</span> <span class="n">StopEarly</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="k">break</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_on_non_simple</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">next_curve</span><span class="o">.</span><span class="n">is_simple</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Curve is non-simple, stopping&quot;</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="k">break</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_step</span><span class="p">(</span><span class="n">next_curve</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">next_curve</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_curve</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_log_state</span><span class="p">(</span><span class="s2">&quot;Final state&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.step" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.Solver.step" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Call <code>Flow.step</code> with the current state and timestep</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Call `Flow.step` with the current state and timestep&quot;&quot;&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Neither of `timestep` or `timestep_fn` were provided.&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="c1"># The `Flow` does the actual work here</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">curve</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">solver</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attach_metadata</span><span class="p">(</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">curve</span><span class="o">=</span><span class="n">curve</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.Solver.stop_on_param_limits" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">stop_on_param_limits</span><span class="p">(</span><span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span></code>

<a href="#curvey.flow.Solver.stop_on_param_limits" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Add a custom stop function based on a parameter value</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>param</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the parameter. This is usually a curve metadata object, e.g. one logged
via <code>Solver.add_curve_loggers</code>. If <code>param_fn</code> is supplied, <code>param</code> is only used as the
parameter name for logging purposes.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_val</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The run is stopped if the parameter value &lt; <code>min_val</code>. <code>None</code> means no lower limit.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_val</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The run is stopped if the parameter value &gt; <code>max_val</code>. <code>None</code> means no upper limit.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>param_fn</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a>], <span title="typing.Any">Any</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional function <code>Curve -&gt; value</code>; if supplied <code>param</code> doesn't need to be available
as <code>Curve</code> metadata.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>self</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="k">def</span> <span class="nf">stop_on_param_limits</span><span class="p">(</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">param_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Curve</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a custom stop function based on a parameter value</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    param</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        The name of the parameter. This is usually a curve metadata object, e.g. one logged</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        via `Solver.add_curve_loggers`. If `param_fn` is supplied, `param` is only used as the</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        parameter name for logging purposes.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    min_val</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        The run is stopped if the parameter value &lt; `min_val`. `None` means no lower limit.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    max_val</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        The run is stopped if the parameter value &gt; `max_val`. `None` means no upper limit.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    param_fn</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        An optional function `Curve -&gt; value`; if supplied `param` doesn&#39;t need to be available</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        as `Curve` metadata.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    -------</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    self</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="k">if</span> <span class="n">param_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">def</span> <span class="nf">param_fn</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">def</span> <span class="nf">param_limits_stop_fn</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">val</span> <span class="o">=</span> <span class="n">param_fn</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">{}</span><span class="s2"> value </span><span class="si">{}</span><span class="s2"> &lt; min value </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">min_val</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">if</span> <span class="n">max_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">{}</span><span class="s2"> value </span><span class="si">{}</span><span class="s2"> &gt; max value </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_stop_fn</span><span class="p">(</span><span class="n">param_limits_stop_fn</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.StopEarly" class="doc doc-heading">
          <code>StopEarly</code>


<a href="#curvey.flow.StopEarly" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>Exception</code></p>

  
      <p>This can be raised in a custom <code>Solver.step_fn</code> to stop the current run</p>
<p>Usually after reaching some stopping criterion.</p>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="k">class</span> <span class="nc">StopEarly</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This can be raised in a custom `Solver.step_fn` to stop the current run</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Usually after reaching some stopping criterion.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="curvey.flow.WillmoreFlow" class="doc doc-heading">
          <code>WillmoreFlow</code>


<a href="#curvey.flow.WillmoreFlow" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="curvey.flow.AbstractCurvatureFlow" href="#curvey.flow.AbstractCurvatureFlow">AbstractCurvatureFlow</a>[<span title="curvey.flow._WillmoreFlowData">_WillmoreFlowData</span>]</code></p>

  
      <p>Willmore Flow</p>
<p>As explained in <a href="https://www.cs.cmu.edu/~kmcrane/Projects/ConformalWillmoreFlow/paper.pdf"><em>Robust Fairing via Conformal Curvature Flow.</em> Keenan Crane, Ulrich Pinkall,
and Peter Schröder. 2014.</a></p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filter_width</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>filter_shape</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The <span class="arithmatex">\(\theta\)</span> and <span class="arithmatex">\(k\)</span> parameters in Crane §4. These filter the curvature flow direction and
can be used to prioritize high or low frequency smoothing.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>constrain</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to apply the closed curve constraints on the curvature flow direction at each
timestep. See method <code>WillmoreFlow.constrain_flow</code> for more details.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>solve_vertices</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to distribute length discretization errors.
See method <code>Curve.with_curvatures</code> for more details.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>realign</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to realign the curve at each timestep to the preceeding one. Because flipping
back and forth between extrinsic and intrinsic representations loses rotation and
translation information, this helps visually align the curve at each step, but may be
an unnecessary computation each iteration if alignment isn't important. See method
<code>Curve.with_curvatures</code> for more details.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>tgt_curvature</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vector of target vertex curvatures to flow towards.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src\curvey\flow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="k">class</span> <span class="nc">WillmoreFlow</span><span class="p">(</span><span class="n">AbstractCurvatureFlow</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">]):</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Willmore Flow</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    As explained in [*Robust Fairing via Conformal Curvature Flow.* Keenan Crane, Ulrich Pinkall,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    and Peter Schröder. 2014.](</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    https://www.cs.cmu.edu/~kmcrane/Projects/ConformalWillmoreFlow/paper.pdf)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    filter_width</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    filter_shape</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        The $\theta$ and $k$ parameters in Crane §4. These filter the curvature flow direction and</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        can be used to prioritize high or low frequency smoothing.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    constrain</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        Whether to apply the closed curve constraints on the curvature flow direction at each</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        timestep. See method `WillmoreFlow.constrain_flow` for more details.</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    solve_vertices</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        Whether to distribute length discretization errors.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        See method `Curve.with_curvatures` for more details.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    realign</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        Whether to realign the curve at each timestep to the preceeding one. Because flipping</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">        back and forth between extrinsic and intrinsic representations loses rotation and</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        translation information, this helps visually align the curve at each step, but may be</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        an unnecessary computation each iteration if alignment isn&#39;t important. See method</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        `Curve.with_curvatures` for more details.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    tgt_curvature</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        Vector of target vertex curvatures to flow towards.</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="n">constrain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">filter_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">filter_shape</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">solve_vertices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="n">realign</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="p">):</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">constrain</span> <span class="o">=</span> <span class="n">constrain</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_width</span> <span class="o">=</span> <span class="n">filter_width</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_shape</span> <span class="o">=</span> <span class="n">filter_shape</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">_filter_params_specified</span> <span class="o">=</span> <span class="p">{</span><span class="n">filter_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filter_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_filter_params_specified</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>                <span class="s2">&quot;Both `filter_width` and `filter_shape` must be specified to filter curvature flow&quot;</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_do_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">_filter_params_specified</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solve_vertices</span> <span class="o">=</span> <span class="n">solve_vertices</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">realign</span> <span class="o">=</span> <span class="n">realign</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span> <span class="o">=</span> <span class="n">tgt_curvature</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="k">def</span> <span class="nf">constrain_flow</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constrain curvature flow as per Crane §5</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">        Constraints are</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        1. end points must meet: $f(0) = f(L)$</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        2. tangents must agree at endpoints: $T(0) = T(L)$.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        curve</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">            The curve to constrain flow for.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        dk</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">            A `n_vertices` length vector indicating the curvature flow.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">        -------</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        dk_constrained</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">            the curvature flow direction after applying the constraints.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">mass</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="k">def</span> <span class="nf">inner_product</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;The L2 inner product ⟨⟨F G⟩⟩&quot;&quot;&quot;</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Projection of f onto g&quot;&quot;&quot;</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="k">return</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="c1"># Construct orthogonal constraint basis (Crane §4, the `c_i` terms) via Gram-Schmidt</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="n">c0</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="n">c1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="c1"># Subtract flow along the constraint basis</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="k">return</span> <span class="n">dk</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="k">def</span> <span class="nf">filter_flow_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter curvature flow gradient&quot;&quot;&quot;</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="n">sigma</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_shape</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;filter_width is None&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;filter_shape is None&quot;</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="c1"># Square matrix `a` here is the term `id - σ∆^k` in Crane §4</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="c1"># `filtered` is inv(a) @ dk</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="c1"># can&#39;t be a sparse array</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>            <span class="n">filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="c1"># lb = curve.laplacian</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="n">lb</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags_array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span> <span class="o">@</span> <span class="n">curve</span><span class="o">.</span><span class="n">laplacian</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">lb</span><span class="o">**</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="n">filtered</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">spsolve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="k">return</span> <span class="n">dk</span> <span class="o">-</span> <span class="n">filtered</span>  <span class="c1"># v ← v - inv(a)v</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>    <span class="k">def</span> <span class="nf">solver</span><span class="p">(</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="n">stop_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="n">stop_on_energy_increase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">]:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a `Solver` for the flow</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">        initial</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">            The initial `Curve`.</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">        stop_tol</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">            Optional stopping tolerance. See `WillmoreFlow.stop_on_gradient_tolerance`</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">            for more details.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">        stop_on_energy_increase</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">            Stop the first time energy is increased. The step with increased energy is discarded.</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        **kwargs</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">            Remaining kwargs passed to the `Solver` constructor.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        -----</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        If neither `timestep` nor `timestep_fn` are supplied to the solver, sets the solver</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">        `timestep_fn` to `self.autotimestep_fn` for adaptive timestep selection. When</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">        `tgt_curvatures` is None, it&#39;s probably safe to just use a reasonably large timestep &lt; 1,</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        but an adaptive timestep seems to be safer for targeted curvature flow.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">_WillmoreFlowData</span><span class="p">(</span><span class="n">stop_on_energy_increase</span><span class="o">=</span><span class="n">stop_on_energy_increase</span><span class="p">)</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="n">solver</span><span class="o">.</span><span class="n">add_curve_loggers</span><span class="p">(</span><span class="n">willmore_energy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">timestep</span> <span class="ow">is</span> <span class="n">solver</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>            <span class="n">solver</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autotimestep_fn</span><span class="p">()</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="k">if</span> <span class="n">stop_tol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>            <span class="n">solver</span><span class="o">.</span><span class="n">add_stop_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_on_gradient_tolerance</span><span class="p">(</span><span class="n">stop_tol</span><span class="p">))</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="k">return</span> <span class="n">solver</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step the curve along its Willmore energy gradient&quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>        <span class="n">k0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="c1"># Calculate curvature gradient, i.e. the derivative of E(k) = ||k||^2</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="n">dk</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_filter</span><span class="p">:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_flow_direction</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrain</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>            <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrain_flow</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="n">k1</span> <span class="o">=</span> <span class="n">k0</span> <span class="o">+</span> <span class="n">timestep</span> <span class="o">*</span> <span class="n">dk</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">with_curvature</span><span class="p">(</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="n">curvature</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="n">solve_vertices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solve_vertices</span><span class="p">,</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="n">realign</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">realign</span><span class="p">,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="p">)</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="k">def</span> <span class="nf">poststep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stop_on_energy_increase&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="n">e1</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">e0</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="k">if</span> <span class="n">e1</span> <span class="o">&gt;</span> <span class="n">e0</span><span class="p">:</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Willmore energy increased </span><span class="si">{}</span><span class="s2"> =&gt; </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">e1</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                <span class="k">raise</span> <span class="n">StopEarly</span><span class="p">()</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="k">return</span> <span class="n">curve</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>        <span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">_Sentinel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">_Sentinel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate curve energy</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        By default uses `self.tgt_curvature`, but can be overridden with the supplied</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">        `tgt_curvature`.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">        If `tgt_curvature` is None, calculates the Willmore energy</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        $$</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">            E(c) = \sum_i^n \kappa_i^2 l_i$</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">        $$</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">        for vertex curvatures $\kappa_i$ and dual edge lengths $l_i$.</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">        If `tgt_curvature` is not None, calculates</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        $$</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">            E(c) = \sum_i^n ( \kappa_i - \hat \kappa_i)^2 l_i</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        $$</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        for target vertex curvatures $\hat \kappa_i$.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="k">if</span> <span class="n">tgt_curvature</span> <span class="ow">is</span> <span class="n">_Sentinel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">:</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="n">tgt_curvature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="k">if</span> <span class="n">tgt_curvature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span> <span class="o">-</span> <span class="n">tgt_curvature</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">dk</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>    <span class="k">def</span> <span class="nf">autotimestep_fn</span><span class="p">(</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="n">min_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="n">max_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct an adaptive timestep function</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        For curve $c$, calculates the timestep as $1 / \sqrt {E(c)}$, for energy $E$, defined</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">        in `WillmoreFlow.energy`. This value is then clamped to `min_step` and `max_step`,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        if supplied.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">        min_step</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="sd">            Minimum timestep.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">        max_step</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">            Maximum timestep</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        -------</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">        timestep_fn</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">            A function `Solver -&gt; timestep`.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="k">def</span> <span class="nf">timestep_fn</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="c1"># NB WillmoreFlow.solver adds an energy logger</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="n">e</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                <span class="c1"># Doesn&#39;t matter what the stepsize is</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                <span class="n">dt</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">clip</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">min_step</span><span class="p">,</span> <span class="n">max_step</span><span class="p">))</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="k">return</span> <span class="n">timestep_fn</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>    <span class="k">def</span> <span class="nf">stop_on_gradient_tolerance</span><span class="p">(</span><span class="n">tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a `Solver` stopping function for the supplied tolerance&quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="k">def</span> <span class="nf">stop_fn</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">):</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">previous</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">e1</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="n">e0</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">previous</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="n">gradient</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">e1</span> <span class="o">-</span> <span class="n">e0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="k">if</span> <span class="n">gradient</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Willmore energy gradient </span><span class="si">{}</span><span class="s2"> &lt; tol </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="k">return</span> <span class="n">stop_fn</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>    <span class="k">def</span> <span class="nf">with_tgt_curvature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WillmoreFlow</span><span class="p">:</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace the target curvatures&quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="n">out</span><span class="o">.</span><span class="n">tgt_curvature</span> <span class="o">=</span> <span class="n">tgt_curvature</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.autotimestep_fn" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">autotimestep_fn</span><span class="p">(</span><span class="n">min_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">1e-05</span><span class="p">,</span> <span class="n">max_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.WillmoreFlow.autotimestep_fn" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Construct an adaptive timestep function</p>
<p>For curve <span class="arithmatex">\(c\)</span>, calculates the timestep as <span class="arithmatex">\(1 / \sqrt {E(c)}\)</span>, for energy <span class="arithmatex">\(E\)</span>, defined
in <code>WillmoreFlow.energy</code>. This value is then clamped to <code>min_step</code> and <code>max_step</code>,
if supplied.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>min_step</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum timestep.</p>
            </div>
          </td>
          <td>
                <code>1e-05</code>
          </td>
        </tr>
        <tr>
          <td><code>max_step</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum timestep</p>
            </div>
          </td>
          <td>
                <code>0.9</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>timestep_fn</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function <code>Solver -&gt; timestep</code>.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="k">def</span> <span class="nf">autotimestep_fn</span><span class="p">(</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>    <span class="n">min_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="n">max_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct an adaptive timestep function</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    For curve $c$, calculates the timestep as $1 / \sqrt {E(c)}$, for energy $E$, defined</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">    in `WillmoreFlow.energy`. This value is then clamped to `min_step` and `max_step`,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">    if supplied.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">    min_step</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="sd">        Minimum timestep.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">    max_step</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">        Maximum timestep</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">    -------</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    timestep_fn</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">        A function `Solver -&gt; timestep`.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="k">def</span> <span class="nf">timestep_fn</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>        <span class="c1"># NB WillmoreFlow.solver adds an energy logger</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>            <span class="c1"># Doesn&#39;t matter what the stepsize is</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">clip</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">min_step</span><span class="p">,</span> <span class="n">max_step</span><span class="p">))</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>    <span class="k">return</span> <span class="n">timestep_fn</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.constrain_flow" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">constrain_flow</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.WillmoreFlow.constrain_flow" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Constrain curvature flow as per Crane §5</p>
<p>Constraints are</p>
<ol>
<li>end points must meet: <span class="arithmatex">\(f(0) = f(L)\)</span></li>
<li>tangents must agree at endpoints: <span class="arithmatex">\(T(0) = T(L)\)</span>.</li>
</ol>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>curve</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The curve to constrain flow for.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dk</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A <code>n_vertices</code> length vector indicating the curvature flow.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dk_constrained</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the curvature flow direction after applying the constraints.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="k">def</span> <span class="nf">constrain_flow</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Constrain curvature flow as per Crane §5</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    Constraints are</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    1. end points must meet: $f(0) = f(L)$</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    2. tangents must agree at endpoints: $T(0) = T(L)$.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    curve</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        The curve to constrain flow for.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    dk</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        A `n_vertices` length vector indicating the curvature flow.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    -------</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    dk_constrained</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">        the curvature flow direction after applying the constraints.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="n">mass</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="k">def</span> <span class="nf">inner_product</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The L2 inner product ⟨⟨F G⟩⟩&quot;&quot;&quot;</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Projection of f onto g&quot;&quot;&quot;</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">return</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="c1"># Construct orthogonal constraint basis (Crane §4, the `c_i` terms) via Gram-Schmidt</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">c0</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="n">c1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="n">c2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="c1"># Subtract flow along the constraint basis</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="k">return</span> <span class="n">dk</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.default_curvature_fn" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.WillmoreFlow.default_curvature_fn" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Simply return the value of the <code>Curve.curvature</code> property</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="k">def</span> <span class="nf">default_curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Simply return the value of the `Curve.curvature` property&quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">curvature</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.energy" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">energy</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">_Sentinel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">_Sentinel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span></code>

<a href="#curvey.flow.WillmoreFlow.energy" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Calculate curve energy</p>
<p>By default uses <code>self.tgt_curvature</code>, but can be overridden with the supplied
<code>tgt_curvature</code>.</p>
<p>If <code>tgt_curvature</code> is None, calculates the Willmore energy</p>
<div class="arithmatex">\[
    E(c) = \sum_i^n \kappa_i^2 l_i$
\]</div>
<p>for vertex curvatures <span class="arithmatex">\(\kappa_i\)</span> and dual edge lengths <span class="arithmatex">\(l_i\)</span>.</p>
<p>If <code>tgt_curvature</code> is not None, calculates</p>
<div class="arithmatex">\[
    E(c) = \sum_i^n ( \kappa_i - \hat \kappa_i)^2 l_i
\]</div>
<p>for target vertex curvatures <span class="arithmatex">\(\hat \kappa_i\)</span>.</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="k">def</span> <span class="nf">energy</span><span class="p">(</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>    <span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">|</span> <span class="n">_Sentinel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">_Sentinel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate curve energy</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">    By default uses `self.tgt_curvature`, but can be overridden with the supplied</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    `tgt_curvature`.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    If `tgt_curvature` is None, calculates the Willmore energy</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    $$</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">        E(c) = \sum_i^n \kappa_i^2 l_i$</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    $$</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">    for vertex curvatures $\kappa_i$ and dual edge lengths $l_i$.</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    If `tgt_curvature` is not None, calculates</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    $$</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        E(c) = \sum_i^n ( \kappa_i - \hat \kappa_i)^2 l_i</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    $$</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    for target vertex curvatures $\hat \kappa_i$.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>    <span class="k">if</span> <span class="n">tgt_curvature</span> <span class="ow">is</span> <span class="n">_Sentinel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">:</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="n">tgt_curvature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="k">if</span> <span class="n">tgt_curvature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>    <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span> <span class="o">-</span> <span class="n">tgt_curvature</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">dk</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.filter_flow_direction" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">filter_flow_direction</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span></code>

<a href="#curvey.flow.WillmoreFlow.filter_flow_direction" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Filter curvature flow gradient</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="k">def</span> <span class="nf">filter_flow_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter curvature flow gradient&quot;&quot;&quot;</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">sigma</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_shape</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;filter_width is None&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;filter_shape is None&quot;</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="c1"># Square matrix `a` here is the term `id - σ∆^k` in Crane §4</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="c1"># `filtered` is inv(a) @ dk</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="c1"># can&#39;t be a sparse array</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="c1"># lb = curve.laplacian</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="n">lb</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags_array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">curve</span><span class="o">.</span><span class="n">dual_edge_length</span><span class="p">)</span> <span class="o">@</span> <span class="n">curve</span><span class="o">.</span><span class="n">laplacian</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">lb</span><span class="o">**</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">spsolve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>    <span class="k">return</span> <span class="n">dk</span> <span class="o">-</span> <span class="n">filtered</span>  <span class="c1"># v ← v - inv(a)v</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.solver" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">solver</span><span class="p">(</span><span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">stop_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop_on_energy_increase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">]</span></code>

<a href="#curvey.flow.WillmoreFlow.solver" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Construct a <code>Solver</code> for the flow</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>initial</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="curvey.curve.Curve" href="../curve/#curvey.curve.Curve">Curve</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The initial <code>Curve</code>.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>stop_tol</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional stopping tolerance. See <code>WillmoreFlow.stop_on_gradient_tolerance</code>
for more details.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>stop_on_energy_increase</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Stop the first time energy is increased. The step with increased energy is discarded.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Remaining kwargs passed to the <code>Solver</code> constructor.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Notes</summary>
  <p>If neither <code>timestep</code> nor <code>timestep_fn</code> are supplied to the solver, sets the solver
<code>timestep_fn</code> to <code>self.autotimestep_fn</code> for adaptive timestep selection. When
<code>tgt_curvatures</code> is None, it's probably safe to just use a reasonably large timestep &lt; 1,
but an adaptive timestep seems to be safer for targeted curvature flow.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="n">initial</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="n">stop_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="n">stop_on_energy_increase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">]:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a `Solver` for the flow</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    initial</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        The initial `Curve`.</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    stop_tol</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">        Optional stopping tolerance. See `WillmoreFlow.stop_on_gradient_tolerance`</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">        for more details.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">    stop_on_energy_increase</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        Stop the first time energy is increased. The step with increased energy is discarded.</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">    **kwargs</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        Remaining kwargs passed to the `Solver` constructor.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    -----</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">    If neither `timestep` nor `timestep_fn` are supplied to the solver, sets the solver</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    `timestep_fn` to `self.autotimestep_fn` for adaptive timestep selection. When</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    `tgt_curvatures` is None, it&#39;s probably safe to just use a reasonably large timestep &lt; 1,</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    but an adaptive timestep seems to be safer for targeted curvature flow.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">_WillmoreFlowData</span><span class="p">(</span><span class="n">stop_on_energy_increase</span><span class="o">=</span><span class="n">stop_on_energy_increase</span><span class="p">)</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">add_curve_loggers</span><span class="p">(</span><span class="n">willmore_energy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">timestep</span> <span class="ow">is</span> <span class="n">solver</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="n">solver</span><span class="o">.</span><span class="n">timestep_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autotimestep_fn</span><span class="p">()</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="k">if</span> <span class="n">stop_tol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">solver</span><span class="o">.</span><span class="n">add_stop_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_on_gradient_tolerance</span><span class="p">(</span><span class="n">stop_tol</span><span class="p">))</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="k">return</span> <span class="n">solver</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.step" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">step</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span></code>

<a href="#curvey.flow.WillmoreFlow.step" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Step the curve along its Willmore energy gradient</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">Curve</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">[</span><span class="n">_WillmoreFlowData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Curve</span><span class="p">:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Step the curve along its Willmore energy gradient&quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>    <span class="n">k0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curvature_fn</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>    <span class="c1"># Calculate curvature gradient, i.e. the derivative of E(k) = ||k||^2</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>    <span class="n">dk</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_curvature</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_filter</span><span class="p">:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_flow_direction</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrain</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrain_flow</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>    <span class="n">k1</span> <span class="o">=</span> <span class="n">k0</span> <span class="o">+</span> <span class="n">timestep</span> <span class="o">*</span> <span class="n">dk</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">with_curvature</span><span class="p">(</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">curvature</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="n">solve_vertices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solve_vertices</span><span class="p">,</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="n">realign</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">realign</span><span class="p">,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="p">)</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.stop_on_gradient_tolerance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">stop_on_gradient_tolerance</span><span class="p">(</span><span class="n">tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#curvey.flow.WillmoreFlow.stop_on_gradient_tolerance" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Construct a <code>Solver</code> stopping function for the supplied tolerance</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="k">def</span> <span class="nf">stop_on_gradient_tolerance</span><span class="p">(</span><span class="n">tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Solver</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a `Solver` stopping function for the supplied tolerance&quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="k">def</span> <span class="nf">stop_fn</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="n">Solver</span><span class="p">):</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">previous</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">e1</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">e0</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">previous</span><span class="p">[</span><span class="s2">&quot;willmore_energy&quot;</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="n">gradient</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">e1</span> <span class="o">-</span> <span class="n">e0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="k">if</span> <span class="n">gradient</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="n">solver</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Willmore energy gradient </span><span class="si">{}</span><span class="s2"> &lt; tol </span><span class="si">{}</span><span class="s2">, stopping&quot;</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="k">return</span> <span class="n">stop_fn</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="curvey.flow.WillmoreFlow.with_tgt_curvature" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">with_tgt_curvature</span><span class="p">(</span><span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WillmoreFlow</span></code>

<a href="#curvey.flow.WillmoreFlow.with_tgt_curvature" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Replace the target curvatures</p>

          <details class="quote">
            <summary>Source code in <code>src\curvey\flow.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="k">def</span> <span class="nf">with_tgt_curvature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tgt_curvature</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WillmoreFlow</span><span class="p">:</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace the target curvatures&quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="n">out</span><span class="o">.</span><span class="n">tgt_curvature</span> <span class="o">=</span> <span class="n">tgt_curvature</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../curves/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Curves">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Curves
              </div>
            </div>
          </a>
        
        
          
          <a href="../blend/" class="md-footer__link md-footer__link--next" aria-label="Next: Blend">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Blend
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>